<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap css -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <div class = "page-header">
            <h1>Glimpse</h1>
        </div>
    </div>
    <div class="container">
        <button type="button" class = "btn btn-primary btn-lg" data-toggle="modal" data-target="#addMediaModal">Add a Media</button>
         <button type="button" class = "btn btn-primary btn-lg" data-toggle="modal" data-target="#addUserModal">Add a User</button>
    </div>

    <div id="addMediaModal" class="modal" role="dialog">
        <div class ="modal-dialog">
            <div class = "modal-content">
                <div class="modal-header" style="padding:35px 50px;">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4><span class="glyphicon glyphicon-lock"></span>Adding Media</h4>
              </div>
              <div class="modal-body">
                <div class = "form-group">
                    <label for="mediaId">Media Id:</label>
                    <input type="text" class = "form-control" id="mediaId" disabled="disabled">
                    <label for="mediaName">Media Name:</label>
                    <input type="text" class = "form-control" id="mediaName">
                    <label for="mediaDescription">Description:</label>
                    <input type="text" class = "form-control" id="mediaDescription">
                    <label for="mediaReleaseDate">Release Date:</label>
                    <input type="text" class = "form-control" id="mediaReleaseDate">
                    <label for="mediaImage">Image:</label>
                    <input type="image" class = "form-control" id="mediaImage">
                    <br></br>
                    <label for="mediaCategory">Category:</label>
                    <SELECT NAME="Category" id="mediaCategory">
                    <OPTION>Action</OPTION>
                    <OPTION>Romance</OPTION>
                    <OPTION>Horror</OPTION>
                    <OPTION>Comedy</OPTION>
                    <OPTION>Documentary</OPTION>
                    </SELECT>
                    <br></br>
                    <label for="mediaFormat">Format:</label>
                    <SELECT NAME="Format" id="mediaFormat">
                    <OPTION>Movie</OPTION>
                    <OPTION>TV Show</OPTION>
                    </SELECT>
                    <br></br>
                    <label for="mediaUploader">Uploader:</label>
                    <input type="text" class = "form-control" id="mediaUploader">
                    <label for="mediaCast">Cast:</label>
                    <input type="text" class = "form-control" id="mediaCast">
                    <label for="mediaTrailerLink">Trailer Link:</label>
                    <input type="text" class = "form-control" id="mediaTrailerLink">   
                      <br></br>
                    <button type = "button" class="btn btn-primary" onclick="addMedia()" data-dismiss="modal">Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>

 <div id="addUserModal" class="modal" role="dialog">
        <div class ="modal-dialog">
            <div class = "modal-content">
                <div class="modal-header" style="padding:35px 50px;">
                  <button type="button" class="close" data-dismiss="addusermodal">&times;</button>
                  <h4><span class="glyphicon glyphicon-lock"></span>Adding User</h4>  
              </div>
              <div class="modal-body">
                <div class = "form-group">
                    <label for="username">Username:</label>
                    <input type="text" class = "form-control" id="username">
                    <label for="password">Password:</label>
                    <input type="text" class = "form-control" id="password">
                    <label for="profileImage">Profile Image:</label>
                    <input type="image" class = "form-control" id="profileImage">
                    <br></br>
                     <button type = "button" class="btn btn-primary" onclick="addUser()" data-dismiss="modal">Submit</button>
                   
                </div>
            </div>
        </div>        
     </div>
 </div>

<div class="container" style="padding:35px 50px">
   <ul class="list-group" id="allMedia">
   </ul>
 <ul class="list-group" id="allUser">
   </ul>

</div>
<!-- Scripts -->

<script src="https://www.gstatic.com/firebasejs/4.5.0/firebase.js"></script>
<script>

        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCt6z6XTg0HFZqKyyXhMDPicSYmgu_2XwM",
            authDomain: "poosd-test.firebaseapp.com",
            databaseURL: "https://poosd-test.firebaseio.com",
            projectId: "poosd-test",
            storageBucket: "",
            messagingSenderId: "1087046017322"
        };
        firebase.initializeApp(config);
        var database = firebase.database();

        function addMedia(){

            var mediaId = document.getElementById('mediaId').value;
            document.getElementById('mediaId').value="";
            var mediaName = document.getElementById('mediaName').value;
            document.getElementById('mediaName').value="";
            var mediaDescription = document.getElementById('mediaDescription').value;
            document.getElementById('mediaDescription').value="";
            var mediaReleaseDate = document.getElementById('mediaReleaseDate').value;
            document.getElementById('mediaReleaseDate').value="";
            var mediaImage = document.getElementById('mediaImage').value;
            document.getElementById('mediaImage').value="";
            var mediaCategory = document.getElementById('mediaCategory').value;
            document.getElementById('mediaCategory').value="";
            var mediaFormat = document.getElementById('mediaFormat').value;
            document.getElementById('mediaFormat').value="";
            var mediaUploader= document.getElementById('mediaUploader').value;
            document.getElementById('mediaUploader').value="";
            var mediaCast = document.getElementById('mediaCast').value;
            document.getElementById('mediaCast').value="";
            var mediaTrailerLink = document.getElementById('mediaTrailerLink').value;
            document.getElementById('mediaTrailerLink').value="";


            
            console.log(mediaName);
            addMediaToDB(mediaId, mediaName, mediaDescription, mediaReleaseDate, mediaImage, mediaCategory, mediaFormat, mediaUploader, mediaCast, mediaTrailerLink);
        }


        function addUser(){
            var username = document.getElementById('username').value;
            document.getElementById('username').value="";
            var password = document.getElementById('password').value;
            document.getElementById('password').value="";
            var profileImage = document.getElementById('profileImage').value;
            document.getElementById('profileImage').value="";

            console.log(username);
            addUserToDB(username, password, profileImage);
        }

        function addUserToDB(username, password, profileImage){
            var showRef = firebase.database().ref('user/'+username);
            showRef.once('value')
            .then(function(snapshot){
                var exists = snapshot.exists();
                if(!exists){
                    showRef.set({
                       username: username,
                       password: password,
                       profileImage: profileImage
                   });
                }
            });
        }

        function addMediaToDB(mediaId, name, mediaDescription, mediaReleaseDate, mediaImage, mediaCategory, mediaFormat, mediaUploader, mediaCast, mediaTrailerLink){
            var mediaRef = firebase.database().ref('media/'+name);
            mediaRef.once('value')
            .then(function(snapshot){
                var exists = snapshot.exists();
                if(!exists){
                    mediaRef.set({
                       id: mediaId,
                       title: name,
                       description: mediaDescription,
                       releaseDate: mediaReleaseDate,
                       image: mediaImage,
                       category: mediaCategory,
                       format: mediaFormat,
                       uploader: mediaUploader,
                       cast: mediaCast,
                       trailerLink: mediaTrailerLink

                   });
                }
            });
        }


        function updateListing(data){
            console.log(data);
            document.getElementById('allMedia').innerHTML+="<li class='list-group-item'>"+data+"</li>";
        }

        var tvListRef = firebase.database().ref('media/');
        tvListRef.on('child_added',function(data){ updateListing(data.val().id+": "+data.val().title+": "+data.val().description+": "+data.val().releaseDate+": "+data.val().category+": "+data.val().format+": "+data.val().uploader+": "+data.val().cast+": "+data.val().trailerLink)});


        var userListRef = firebase.database().ref('user/');
        userListRef.on('child_added',function(data){ updateListing(data.val().username+": "+data.val().password+": "+data.val().image)});

    </script>


</body>
</html>